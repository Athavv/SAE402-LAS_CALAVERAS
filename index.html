<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dia de los Muertos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/globe.gl"></script>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root {
      --orange: #FF6B35;
      --violet: #9400D3;
      --dark-purple: #2D004B;
    }
    
    body {
      background-color: #000;
      color: white;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }
    
    .title {
      position: fixed;
      top: 20px;
      left: 20px;
      color: var(--orange);
      font-size: 1.5rem;
      font-weight: bold;
      z-index: 1000;
      text-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    
    #globeViz {
      width: 100vw;
      height: 100vh;
      transition: width 0.3s ease;
    }
    
    #popup {
      position: fixed;
      top: 0;
      right: -500px;
      width: 500px;
      height: 100vh;
      background: linear-gradient(135deg, rgba(45, 0, 75, 0.95) 0%, rgba(70, 0, 110, 0.95) 100%);
      border-left: 4px solid var(--orange);
      box-shadow: -5px 0 30px rgba(0, 0, 0, 0.7);
      padding: 30px;
      z-index: 1050;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: right 0.3s ease;
    }
    
    #popup.visible {
      right: 0;
    }
    
    .btn-close-custom {
      position: absolute;
      right: 25px;
      top: 25px;
      color: white;
      background: transparent;
      border: none;
      font-size: 1.8rem;
      opacity: 0.8;
      transition: all 0.2s;
      z-index: 1100;
    }
    
    .btn-close-custom:hover {
      opacity: 1;
      color: var(--orange);
      transform: scale(1.1);
    }
    
    #skullViewer {
      width: 100%;
      height: 350px;
      min-height: 350px;
      border-radius: 8px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }
    
    .calavera-title {
      color: var(--orange);
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--violet);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      font-size: 2rem;
    }
    
    .btn-toggle {
      width: 150px;
      margin: 0 auto 25px auto;
      background: var(--violet);
      color: white;
      border: 2px solid var(--orange);
      font-weight: bold;
      padding: 8px 12px;
      font-size: 1rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn-toggle:hover {
      background: var(--orange);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
    }
    
    .btn-toggle.collapsed .fa-chevron-down {
      transform: rotate(0deg);
    }
    
    .btn-toggle:not(.collapsed) .fa-chevron-down {
      transform: rotate(180deg);
    }
    
    .history-text {
      color: #fff;
      line-height: 1.8;
      overflow-y: auto;
      flex-grow: 1;
      padding-right: 15px;
      font-size: 1.1rem;
    }
    
    .history-text::-webkit-scrollbar {
      width: 8px;
    }
    
    .history-text::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
    }
    
    .history-text::-webkit-scrollbar-thumb {
      background-color: var(--orange);
      border-radius: 4px;
    }
    
    .text-orange {
      color: var(--orange) !important;
      font-size: 1.3rem;
    }
    
    .fst-italic {
      font-style: italic;
      color: #ddd;
      font-size: 1.2rem;
    }
    
    .content-container {
      display: flex;
      flex-direction: column;
      height: calc(100% - 350px);
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div class="title">SAE 402 - DIA DE LOS MUERTOS</div>
  <div id="globeViz"></div>

  <div id="popup">
    <button class="btn-close-custom" onclick="closePopup()">×</button>
    
    <model-viewer
      id="skullViewer"
      alt="Skull 3D Model"
      src="./ressources/CalaverasTrystan_Kecket-Baker_Aathavan Thevakumar.glb"
      camera-controls
      auto-rotate
      environment-image="neutral">
    </model-viewer>

    <div class="content-container">
      <h2 class="calavera-title">LAS CALAVERAS : LA MORT SOURIT</h2>
      
      <button class="btn btn-toggle collapsed w-100" data-bs-toggle="collapse" data-bs-target="#textContent">
        <i class="fas fa-chevron-down me-2"></i> En savoir plus
      </button>
      
      <div class="history-text collapse" id="textContent">
        <p class="fst-italic">"Pourquoi notre vision de la mort est si morose, si pessimiste, si négative ?"</p>
        
        <p>Au Mexique, on célèbre la mort lors d'El Día de los Muertos. Malgré le fait d'avoir perdu un proche, les Mexicains honorent leur mémoire avec joie. Particulièrement à travers les calaveras, l'un des symboles de cette fête.</p>

        <h5 class="text-orange mt-4"><i class="fas fa-skull me-2"></i>Les Calaveras traditionnelles</h5>
        <p>Crânes humains le plus souvent en céramique décorée de peintures vives servant d'offrande sur les autels des défunts.</p>

        <h5 class="text-orange mt-3"><i class="fas fa-candy-cane me-2"></i>Les Calaveras comestibles</h5>
        <p>Dérivées en bonbons avec des crânes en pâte à sucre, amarante ou chocolat, utilisées de manière décorative et symbolique plutôt qu'alimentaire.</p>

        <h5 class="text-orange mt-3"><i class="fas fa-book me-2"></i>Les Calaveras literarias</h5>
        <p>Poèmes humoristiques qui se moquent des vivants, souvent accompagnés d'illustrations de squelettes animés.</p>

        <h5 class="text-orange mt-3"><i class="fas fa-hat-cowboy me-2"></i>La Catrina</h5>
        <p>Personnage emblématique devenu icône internationale, rappelant que nous avons tous la même finalité, quelle que soit notre condition sociale.</p>
      </div>
    </div>
  </div>

  <script>
    let globeInstance = null;

    function initGlobe() {
      // Configuration du globe
      globeInstance = Globe()
        .globeImageUrl(null)
        .showAtmosphere(false)
        .backgroundColor('rgba(0,0,0,0)')
        .polygonCapColor(d => d.properties.ISO_A2 === 'MX' ? '#9400D3' : 'rgba(255,255,255,0.1)')
        .polygonStrokeColor(d => d.properties.ISO_A2 === 'MX' ? '#FF6B35' : 'rgba(255,255,255,0.3)');

      // Initialisation
      const container = document.getElementById('globeViz');
      globeInstance(container)
        .width(container.clientWidth)
        .height(container.clientHeight);

      // Contrôles
      globeInstance.controls().autoRotate = true;
      globeInstance.controls().autoRotateSpeed = 0.5;

      // Chargement des données
      fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson')
        .then(res => res.json())
        .then(countries => {
          globeInstance.polygonsData(countries.features)
            .onPolygonClick(d => {
              if (d.properties.ISO_A2 === 'MX') {
                document.getElementById('popup').classList.add('visible');
                document.getElementById('globeViz').style.width = 'calc(100vw - 500px)';
              }
            });
        });
    }

    function closePopup() {
      document.getElementById('popup').classList.remove('visible');
      document.getElementById('globeViz').style.width = '100vw';
    }

    window.addEventListener('load', initGlobe);
    window.closePopup = closePopup;
  </script>
</body>
</html>